import{_ as e,r as o,o as c,c as l,b as s,d as n,e as p,a as t}from"./app.822402f0.js";const i={},r=s("h1",{id:"\u524D\u7AEF\u5F55\u5C4F-\u5B9A\u4F4D\u6E90\u7801-\u5E2E\u4F60\u5FEB\u901F\u5B9A\u4F4D\u7EBF\u4E0A-bug",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u524D\u7AEF\u5F55\u5C4F-\u5B9A\u4F4D\u6E90\u7801-\u5E2E\u4F60\u5FEB\u901F\u5B9A\u4F4D\u7EBF\u4E0A-bug","aria-hidden":"true"},"#"),n(" \u524D\u7AEF\u5F55\u5C4F+\u5B9A\u4F4D\u6E90\u7801\uFF0C\u5E2E\u4F60\u5FEB\u901F\u5B9A\u4F4D\u7EBF\u4E0A bug")],-1),u=s("p",null,"\u5982\u4F55\u5FEB\u901F\u5B9A\u4F4D\u7EBF\u4E0Abug\uFF0C\u662F\u591A\u6570\u5F00\u53D1\u8005\u90FD\u4F1A\u9047\u5230\u7684\u96BE\u9898",-1),k={href:"https://github.com/xy-sea/web-see",target:"_blank",rel:"noopener noreferrer"},d=t(`<p><strong>\u5B9A\u4F4D\u6E90\u7801</strong></p><p>\u524D\u7AEF\u9879\u76EE\u53D1\u5E03\u4E0A\u7EBF\uFF0C\u4EE3\u7801\u4E00\u822C\u90FD\u4F1A\u8FDB\u884C\u538B\u7F29\u3001\u6DF7\u6DC6\u3001\u751A\u81F3\u52A0\u5BC6\uFF0C\u5F53\u7EBF\u4E0A\u4EE3\u7801\u62A5\u9519\u65F6\uFF0C\u5F88\u96BE\u5B9A\u4F4D\u5230\u5177\u4F53\u7684\u6E90\u7801</p><p>SourceMap \u5B8C\u7F8E\u89E3\u51B3\u4E86\u4EE3\u7801\u53CD\u89E3\u7684\u95EE\u9898\uFF0C\u9879\u76EE\u5728\u6253\u5305\u65F6\uFF0C\u9664\u4E86\u751F\u6210\u6700\u7EC8 XXX.js \u6587\u4EF6\u5916\uFF0C\u8FD8\u4F1A\u989D\u5916\u751F\u6210\u4E00\u4E2A XXX.js.map \u7684\u6587\u4EF6</p><p>.map \u6587\u4EF6\u91CC\u5305\u542B\u4E86\u539F\u59CB\u4EE3\u7801\u53CA\u5176\u6620\u5C04\u4FE1\u606F\uFF0C\u53EF\u4EE5\u5229\u7528\u5B83\u53CD\u89E3\u51FA\u62A5\u9519\u4FE1\u606F\u7684\u6E90\u7801</p><ul><li>SourceMap \u6587\u4EF6</li></ul><p>\u5148\u4E86\u89E3\u4E0B SourceMap \u7684\u57FA\u672C\u5185\u5BB9</p><p>\u4F8B\u5982 app.a2a3ceec.js \u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">add</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> x<span class="token operator">+</span>y<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//# sourceMappingURL=app.a2a3ceec.js.map</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u4E2D sourceMappingURL \u7528\u6765\u8BF4\u660E\u8BE5\u6587\u4EF6\u5BF9\u5E94\u7684map\u6587\u4EF6</p><p>\u5BF9\u5E94\u7684 app.a2a3ceec.js.map \u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">version</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// SourceMap\u6807\u51C6\u7248\u672C,\u6700\u65B0\u7684\u4E3A3</span>
  <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&quot;js/app.a2a3ceec.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u8F6C\u6362\u540E\u7684\u6587\u4EF6\u540D</span>
  <span class="token literal-property property">sourceRoot</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u8F6C\u6362\u524D\u7684\u6587\u4EF6\u6240\u5728\u76EE\u5F55\uFF0C\u5982\u679C\u4E0E\u8F6C\u6362\u524D\u7684\u6587\u4EF6\u5728\u540C\u4E00\u76EE\u5F55\uFF0C\u8BE5\u9879\u4E3A\u7A7A</span>
  <span class="token literal-property property">sources</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// \u8F6C\u6362\u524D\u7684\u6587\u4EF6\uFF0C\u8BE5\u9879\u662F\u4E00\u4E2A\u6570\u7EC4\uFF0C\u8868\u793A\u53EF\u80FD\u5B58\u5728\u591A\u4E2A\u6587\u4EF6\u5408\u5E76</span>
    <span class="token string">&quot;webpack://web-see-demo/./src/App.vue&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack://web-see-demo/./src/main.js&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> 
  <span class="token literal-property property">names</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// \u8F6C\u6362\u524D\u7684\u6240\u6709\u53D8\u91CF\u540D\u548C\u5C5E\u6027\u540D</span>
  <span class="token literal-property property">sourcesContent</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// \u539F\u59CB\u6587\u4EF6\u5185\u5BB9</span>
    <span class="token string">&quot;const add = (x,y) =&gt; {\\n  return x+y;\\n}&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// \u6240\u6709\u6620\u5C04\u70B9</span>
  <span class="token literal-property property">mappings</span><span class="token operator">:</span> <span class="token string">&quot;AAAA,IAAM,GAAG,GAAG,UAAC,CAAQ,EAAC,CAAQ;IAC5B,OAAO,CAAC,GAAC,CAAC,CAAC;AACb,CAAC,CAAA&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u4E2D sources \u548C sourcesContent \u662F\u5173\u952E\u5B57\u6BB5\uFF0C\u4E0B\u6587\u7684\u8FD8\u539F\u793A\u4F8B\u4E2D\u5C06\u7528\u5230</p><p><strong>source-map-js \u5E93</strong></p>`,13),v={href:"https://www.npmjs.com/package/source-map",target:"_blank",rel:"noopener noreferrer"},m=t(`<p>\u793A\u4F8B\u4EE3\u7801\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> sourceMap <span class="token keyword">from</span> <span class="token string">&#39;source-map-js&#39;</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
* findCodeBySourceMap\u7528\u4E8E\u83B7\u53D6map\u6587\u4EF6\u5BF9\u5E94\u7684\u6E90\u4EE3\u7801
* <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span> string <span class="token punctuation">}</span></span> <span class="token parameter">fileName</span> .map\u6587\u4EF6\u540D\u79F0
* <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span> number <span class="token punctuation">}</span></span> <span class="token parameter">line</span> \u53D1\u751F\u9519\u8BEF\u7684\u884C\u53F7
* <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span> number <span class="token punctuation">}</span></span> <span class="token parameter">column</span> \u53D1\u751F\u9519\u8BEF\u7684\u5217\u53F7
* <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span> <span class="token keyword">function</span> <span class="token punctuation">}</span></span> <span class="token parameter">\u56DE\u8C03\u51FD\u6570\uFF0C\u8FD4\u56DE\u5BF9\u5E94\u7684\u6E90\u7801</span>
*/</span>
<span class="token keyword">const</span> <span class="token function-variable function">findCodeBySourceMap</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> fileName<span class="token punctuation">,</span> line<span class="token punctuation">,</span> column <span class="token punctuation">}</span><span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// loadSourceMap \u7528\u4E8E\u83B7\u53D6\u670D\u52A1\u5668\u4E0A .map \u7684\u6587\u4EF6\u5185\u5BB9</span>
  <span class="token keyword">let</span> sourceData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loadSourceMap</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> sourcesContent<span class="token punctuation">,</span> sources <span class="token punctuation">}</span> <span class="token operator">=</span> sourceData<span class="token punctuation">;</span>
  <span class="token comment">// SourceMapConsumer\u5B9E\u4F8B\u8868\u793A\u4E00\u4E2A\u5DF2\u89E3\u6790\u7684\u6E90\u6620\u5C04</span>
  <span class="token comment">// \u53EF\u4EE5\u901A\u8FC7\u5728\u751F\u6210\u7684\u6E90\u4E2D\u7ED9\u5B83\u4E00\u4E2A\u6587\u4EF6\u4F4D\u7F6E\u6765\u67E5\u8BE2\u6709\u5173\u539F\u59CB\u6587\u4EF6\u4F4D\u7F6E\u7684\u4FE1\u606F</span>
  <span class="token keyword">let</span> consumer <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">sourceMap<span class="token punctuation">.</span>SourceMapConsumer</span><span class="token punctuation">(</span>sourceData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u8F93\u5165\u9519\u8BEF\u7684\u53D1\u751F\u884C\u548C\u5217\uFF0C\u53EF\u4EE5\u5F97\u5230\u6E90\u7801\u5BF9\u5E94\u539F\u59CB\u6587\u4EF6\u3001\u884C\u548C\u5217\u4FE1\u606F</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">originalPositionFor</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">line</span><span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">column</span><span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>column<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u4ECEsourcesContent\u5F97\u5230\u5177\u4F53\u7684\u6E90\u7801\u4FE1\u606F</span>
  <span class="token keyword">let</span> code <span class="token operator">=</span> sourcesContent<span class="token punctuation">[</span>sources<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>source<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  \u2026\u2026
  <span class="token function">callback</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>source-map \u7684\u8FD8\u539F\u6D41\u7A0B\uFF1A <ul><li>\u4ECE\u670D\u52A1\u5668\u83B7\u53D6\u6307\u5B9A.map \u7684\u6587\u4EF6\u5185\u5BB9</li><li>new \u4E00\u4E2A SourceMapConsumer \u7684\u5B9E\u4F8B\uFF0C\u8868\u793A\u4E00\u4E2A\u5DF2\u89E3\u6790\u7684\u6E90\u6620\u5C04\uFF0C\u7ED9\u5B83\u4E00\u4E2A\u6587\u4EF6\u4F4D\u7F6E\u6765\u67E5\u8BE2\u6709\u5173\u539F\u59CB\u6587\u4EF6\u4F4D\u7F6E\u7684\u4FE1\u606F</li><li>\u8F93\u5165\u62A5\u9519\u53D1\u751F\u7684\u884C\u548C\u5217\uFF0C\u53EF\u4EE5\u5F97\u5230\u6E90\u7801\u5BF9\u5E94\u539F\u59CB\u6587\u4EF6\u540D\u3001\u884C\u548C\u5217\u4FE1\u606F</li><li>\u4ECE\u6E90\u6587\u4EF6\u7684 sourcesContent \u5B57\u6BB5\u4E2D\uFF0C\u83B7\u53D6\u5BF9\u5E94\u7684\u6E90\u7801\u4FE1\u606F</li></ul></li></ul><p>\u63A5\u4E0B\u6765\u7684\u91CD\u70B9\u5C31\u53D8\u4E3A\uFF1A\u5982\u4F55\u83B7\u53D6\u62A5\u9519\u53D1\u751F\u7684\u539F\u59CB\u6587\u4EF6\u540D\u3001\u884C\u548C\u5217\u4FE1\u606F</p><p><strong>error-stack-parser \u5E93</strong></p><p>\u901A\u8FC7\u7B2C\u4E00\u7BC7\u6587\u7AE0\u7684\u4ECB\u7ECD\uFF0C\u6211\u4EEC\u77E5\u9053\u53EF\u4EE5\u901A\u8FC7\u591A\u79CD\u65B9\u5F0F\u6765\u6355\u83B7\u62A5\u9519</p><p>\u6BD4\u5982 error\u4E8B\u4EF6\u3001unhandledrejection\u4E8B\u4EF6\u3001vue \u4E2D\u901A\u8FC7Vue.config.errorHander\u3001react\u4E2D\u901A\u8FC7componentDidCatch</p>`,7),b={href:"https://www.npmjs.com/package/error-stack-parser",target:"_blank",rel:"noopener noreferrer"},y=t(`<p>\u793A\u4F8B\u4EE3\u7801\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> ErrorStackParser <span class="token keyword">from</span> <span class="token string">&#39;error-stack-parser&#39;</span><span class="token punctuation">;</span>

ErrorStackParser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;BOOM&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u8FD4\u56DE\u503C StackFrame \u5806\u6808\u5217\u8868</span>
<span class="token punctuation">[</span>
    <span class="token function">StackFrame</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">functionName</span><span class="token operator">:</span> <span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">&#39;path/to/file.js&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">lineNumber</span><span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token literal-property property">columnNumber</span><span class="token operator">:</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token literal-property property">isNative</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">isEval</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">StackFrame</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">functionName</span><span class="token operator">:</span> <span class="token string">&#39;Bar&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">&#39;https://cdn.somewherefast.com/utils.min.js&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">lineNumber</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">columnNumber</span><span class="token operator">:</span> <span class="token number">832</span><span class="token punctuation">,</span> <span class="token literal-property property">isNative</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">isEval</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">isConstructor</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">StackFrame</span><span class="token punctuation">(</span><span class="token operator">...</span> and so on <span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u7B80\u5355\u8BF4\u660E\u4E0B JS \u5806\u6808\u5217\u8868</p><p>\u5806\u6808\u793A\u4F8B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> bar <span class="token operator">=</span> baz<span class="token punctuation">;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u4F1A\u5728\u6267\u884C\u5230 c \u51FD\u6570\u7684\u65F6\u5019\u62A5\u9519\uFF0C\u8C03\u7528\u6808\u4E3A a -&gt; b -&gt; c</p><p>\u4E00\u822C\u6211\u4EEC\u53EA\u9700\u8981\u5B9A\u4F4D\u5230 c \u51FD\u6570\u7684\u5806\u6808\u4FE1\u606F\uFF0C\u6240\u4EE5\u4F7F\u7528 error-stack-parser \u5E93\u7684\u65F6\u5019\uFF0C\u53EA\u53D6 StackFrame \u6570\u7EC4\u4E2D\u7684\u7B2C\u4E00\u4E2A\u5143\u7D20</p><p>\u6700\u7EC8\u4EE3\u7801\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> ErrorStackParser <span class="token keyword">from</span> <span class="token string">&#39;error-stack-parser&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// \u53D6StackFrame\u6570\u7EC4\u4E2D\u7684\u7B2C\u4E00\u4E2A\u5143\u7D20</span>
<span class="token keyword">let</span> stackFrame <span class="token operator">=</span> ErrorStackParser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// \u83B7\u53D6\u5BF9\u5E94\u7684\u539F\u59CB\u6587\u4EF6\u540D\u3001\u884C\u548C\u5217\u4FE1\u606F\uFF0C\u5E76\u4E0A\u62A5</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> fileName<span class="token punctuation">,</span> columnNumber<span class="token punctuation">,</span> lineNumber <span class="token punctuation">}</span> <span class="token operator">=</span> stackFrame<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u793A\u4F8B\u6F14\u793A</strong></p>`,10),w={href:"https://github.com/xy-sea/web-see-demo",target:"_blank",rel:"noopener noreferrer"},g=t('<p>1\uFF09\u70B9\u51FB js\u9519\u8BEF \u6309\u94AE\uFF0C\u4F1A\u6267\u884C HomeView.vue \u6587\u4EF6\u4E2D\u7684 codeErr \u65B9\u6CD5</p><p>2\uFF09Vue.config.errorHander\u4E2D\u6355\u83B7\u5230\u62A5\u9519\u4FE1\u606F</p><p>3\uFF09\u4F7F\u7528 ErrorStackParser.parse \u89E3\u6790</p><p>4\uFF09\u7ECF\u8FC7 consumer.originalPositionFor \u8FD8\u539F\u540E\u7684 result \u7ED3\u679C</p><p>5\uFF09\u6700\u7EC8\u62FF\u5230\u7684\u6E90\u7801</p><ul><li>\u5B9A\u4F4D\u6E90\u7801\u6D41\u7A0B\u603B\u7ED3\uFF1A <ul><li>\u9879\u76EE\u4E2D\u5F15\u5165\u76D1\u63A7 SDK\uFF0C\u6253\u5305\u540E\u5C06js\u6587\u4EF6\u53D1\u5E03\u5230\u670D\u52A1\u5668\u4E0A</li><li>\u5C06 .map \u6587\u4EF6\u653E\u5230\u6307\u5B9A\u7684\u5730\u5740\uFF0C\u7EDF\u4E00\u5B58\u50A8</li><li>\u5F53\u7EBF\u4E0A\u4EE3\u7801\u62A5\u9519\u65F6\uFF0C\u5229\u7528 error-stack-parser \u83B7\u53D6\u5177\u4F53\u539F\u59CB\u6587\u4EF6\u540D\u3001\u884C\u548C\u5217\u4FE1\u606F\uFF0C\u5E76\u4E0A\u62A5</li><li>\u5229\u7528 source-map \u4ECE .map \u6587\u4EF6\u4E2D\u5F97\u5230\u5BF9\u5E94\u7684\u6E90\u7801\u5E76\u5C55\u793A</li></ul></li></ul><h2 id="\u524D\u7AEF\u5F55\u5C4F" tabindex="-1"><a class="header-anchor" href="#\u524D\u7AEF\u5F55\u5C4F" aria-hidden="true">#</a> \u524D\u7AEF\u5F55\u5C4F</h2>',7),f={href:"https://github.com/rrweb-io/rrweb",target:"_blank",rel:"noopener noreferrer"},h=t(`<p><strong>rrweb \u4F7F\u7528</strong></p><p>\u5148\u4ECB\u7ECD\u4E0B\u5728vue\u4E2D\u5982\u4F55\u4F7F\u7528</p><p>\u5F55\u5236\u793A\u4F8B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> record <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;rrweb&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// events\u5B58\u50A8\u5F55\u5C4F\u4FE1\u606F</span>
<span class="token keyword">let</span> events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// record \u7528\u4E8E\u8BB0\u5F55 \`DOM\` \u4E2D\u7684\u6240\u6709\u53D8\u66F4</span>
rrweb<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> isCheckout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// isCheckout \u662F\u4E00\u4E2A\u6807\u8BC6\uFF0C\u544A\u8BC9\u4F60\u91CD\u65B0\u5236\u4F5C\u4E86\u5FEB\u7167</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isCheckout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      events<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    events<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">recordCanvas</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// \u8BB0\u5F55 canvas \u5185\u5BB9</span>
  <span class="token literal-property property">checkoutEveryNms</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// \u6BCF10s\u91CD\u65B0\u5236\u4F5C\u5FEB\u7167</span>
  <span class="token literal-property property">checkoutEveryNth</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token comment">// \u6BCF 200 \u4E2A event \u91CD\u65B0\u5236\u4F5C\u5FEB\u7167</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u64AD\u653E\u793A\u4F8B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token string">&#39;player&#39;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> rrwebPlayer <span class="token keyword">from</span> <span class="token string">&#39;rrweb-player&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#39;rrweb-player/dist/style.css&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
   <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// \u5C06\u8BB0\u5F55\u7684\u53D8\u66F4\u6309\u7167\u5BF9\u5E94\u7684\u65F6\u95F4\u4E00\u4E00\u91CD\u653E</span>
     <span class="token keyword">new</span> <span class="token class-name">rrwebPlayer</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>player<span class="token punctuation">,</span> <span class="token comment">// \u56DE\u653E\u6240\u9700\u8981\u7684HTML\u5143\u7D20</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> events <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">UNSAFE_replayCanvas</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// \u56DE\u653E canvas \u5185\u5BB9</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rrweb-\u539F\u7406\u6D45\u6790" tabindex="-1"><a class="header-anchor" href="#rrweb-\u539F\u7406\u6D45\u6790" aria-hidden="true">#</a> rrweb \u539F\u7406\u6D45\u6790</h3><p>rrweb \u4E3B\u8981\u7531 rrweb \u3001 rrweb-player \u548C rrweb-snapshot \u4E09\u4E2A\u5E93\u7EC4\u6210\uFF1A</p><p>1\uFF09rrweb\uFF1A\u63D0\u4F9B\u4E86 record \u548C replay \u4E24\u4E2A\u65B9\u6CD5\uFF1Brecord \u65B9\u6CD5\u7528\u6765\u8BB0\u5F55\u9875\u9762\u4E0A DOM \u7684\u53D8\u5316\uFF0Creplay \u65B9\u6CD5\u652F\u6301\u6839\u636E\u65F6\u95F4\u6233\u53BB\u8FD8\u539F DOM \u7684\u53D8\u5316</p><p>2\uFF09rrweb-player\uFF1A\u57FA\u4E8E svelte \u6A21\u677F\u5B9E\u73B0\uFF0C\u4E3A rrweb \u63D0\u4F9B\u4E86\u56DE\u653E\u7684 GUI \u5DE5\u5177\uFF0C\u652F\u6301\u6682\u505C\u3001\u500D\u901F\u64AD\u653E\u3001\u62D6\u62FD\u65F6\u95F4\u8F74\u7B49\u529F\u80FD\u3002\u5185\u90E8\u8C03\u7528\u4E86 rrweb \u7684\u63D0\u4F9B\u7684 replay \u7B49\u65B9\u6CD5</p><p>3\uFF09rrweb-snapshot\uFF1A\u5305\u62EC snapshot \u548C rebuilding \u4E24\u5927\u7279\u6027\uFF0Csnapshot \u7528\u6765\u5E8F\u5217\u5316 DOM \u4E3A\u589E\u91CF\u5FEB\u7167\uFF0Crebuilding \u8D1F\u8D23\u5C06\u589E\u91CF\u5FEB\u7167\u8FD8\u539F\u4E3A DOM</p><p>rrweb \u6574\u4F53\u6D41\u7A0B\uFF1A</p><p>1\uFF09rrweb \u5728\u5F55\u5236\u65F6\u4F1A\u9996\u5148\u8FDB\u884C\u9996\u5C4F DOM \u5FEB\u7167\uFF0C\u904D\u5386\u6574\u4E2A\u9875\u9762\u7684 DOM \u6811\uFF0C\u8F6C\u6362\u4E3A JSON \u7ED3\u6784\u6570\u636E\uFF0C\u4F7F\u7528\u589E\u91CF\u5FEB\u7167\u7684\u5904\u7406\u65B9\u5F0F\uFF0C\u901A\u8FC7 mutationObserver \u83B7\u53D6 DOM \u589E\u91CF\u53D8\u5316\uFF0C\u540C\u6B65\u8F6C\u6362\u4E3A JSON \u6570\u636E\u8FDB\u884C\u5B58\u50A8</p><p>2\uFF09\u6574\u4E2A\u5F55\u5236\u7684\u8FC7\u7A0B\u4F1A\u751F\u6210 unique id\uFF0C\u6765\u786E\u5B9A\u589E\u91CF\u6570\u636E\u6240\u5BF9\u5E94\u7684 DOM \u8282\u70B9\uFF0C\u901A\u8FC7 timestamp \u4FDD\u8BC1\u56DE\u653E\u987A\u5E8F\u3002</p><p>3\uFF09 \u56DE\u653E\u65F6\uFF0C\u4F1A\u521B\u5EFA\u4E00\u4E2A iframe \u4F5C\u4E3A\u627F\u8F7D\u4E8B\u4EF6\u56DE\u653E\u7684\u5BB9\u5668\uFF0C\u9488\u5BF9\u9996\u5C4F DOM \u5FEB\u7167\u8FDB\u884C\u91CD\u5EFA\uFF0C\u5728\u904D\u5386 JSON \u7684\u540C\u65F6\uFF0C\u6839\u636E\u5E8F\u5217\u5316\u540E\u7684\u8282\u70B9\u6570\u636E\u6784\u5EFA\u51FA\u5B9E\u9645\u7684 DOM \u8282\u70B9</p><p>4\uFF09rrweb \u53EF\u4EE5\u76D1\u542C\u7684\u7528\u6237\u884C\u4E3A\u5305\u62EC\uFF1A\u9F20\u6807\u79FB\u52A8\uFF0C\u9F20\u6807\u4EA4\u4E92\uFF0C\u9875\u9762\u6EDA\u52A8\uFF0C\u89C6\u7A97\u53D8\u5316\u3001\u7528\u6237\u8F93\u5165\u7B49\uFF0C\u901A\u8FC7\u6DFB\u52A0\u76F8\u5E94\u7684\u76D1\u542C\u4E8B\u4EF6\u6765\u5B9E\u73B0</p><h3 id="\u538B\u7F29\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#\u538B\u7F29\u6570\u636E" aria-hidden="true">#</a> \u538B\u7F29\u6570\u636E</h3><p>\u5982\u679C\u4E00\u76F4\u5F55\u5C4F\uFF0C\u6570\u636E\u91CF\u662F\u5DE8\u5927\u7684</p><p>\u5B9E\u6D4B\u4E0B\u6765\uFF0C\u5F55\u523610s\u7684\u65F6\u957F\uFF0C\u6570\u636E\u5927\u5C0F\u7EA6\u4E3A 8M \u5DE6\u53F3\uFF08\u9875\u9762\u7684\u4E0D\u540C\u590D\u6742\u5EA6\u3001\u7528\u6237\u4E0D\u540C\u64CD\u4F5C\u7684\u9891\u7387\u90FD\u4F1A\u9020\u6210\u5927\u5C0F\u4E0D\u4E00\u6837\uFF09</p>`,19),_={href:"https://github.com/rrweb-io/rrweb/blob/master/docs/recipes/optimize-storage.zh_CN.md",target:"_blank",rel:"noopener noreferrer"},j=t(`<p>\u57FA\u4E8E packFn \u7684\u5355\u6570\u636E\u538B\u7F29\uFF0C\u5728\u5F55\u5236\u65F6\u53EF\u4EE5\u4F5C\u4E3A packFn \u4F20\u5165</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>rrweb<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">packFn</span><span class="token operator">:</span> rrweb<span class="token punctuation">.</span>pack<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u56DE\u653E\u65F6\uFF0C\u9700\u8981\u4F20\u5165 rrweb.unpack \u4F5C\u4E3A unpackFn \u4F20\u5165</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> replayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">rrweb<span class="token punctuation">.</span>Replayer</span><span class="token punctuation">(</span>events<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">unpackFn</span><span class="token operator">:</span> rrweb<span class="token punctuation">.</span>unpack<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F46\u662F\u5B98\u65B9\u63D0\u4F9B\u7684\u538B\u7F29\u65B9\u5F0F\uFF0C\u662F\u5BF9\u6BCF\u4E2A event \u6570\u636E\u5355\u72EC\u8FDB\u884C\u538B\u7F29\uFF0C\u538B\u7F29\u6BD4\u4E0D\u9AD8\u3002\u5B9E\u6D4B\u4E0B\u6765\uFF0C\u538B\u7F29\u6BD4\u572870%\u5DE6\u53F3\uFF0C\u6BD4\u5982\u539F\u6765 8M \u7684\u6570\u636E\uFF0C\u538B\u7F29\u540E\u4E3A 2.4M \u5DE6\u53F3</p><p>\u5B98\u65B9\u66F4\u52A0\u63A8\u8350\u5C06\u591A\u4E2A event \u6279\u91CF\u4E00\u6B21\u6027\u538B\u7F29\uFF0C\u8FD9\u6837\u538B\u7F29\u6548\u679C\u66F4\u597D</p>`,6),S={href:"https://www.npmjs.com/package/pako",target:"_blank",rel:"noopener noreferrer"},C={href:"https://www.npmjs.com/package/js-base64",target:"_blank",rel:"noopener noreferrer"},x=t(`<p>\u538B\u7F29\u4EE3\u7801\u793A\u4F8B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> pako <span class="token keyword">from</span> <span class="token string">&#39;pako&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Base64 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;js-base64&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// \u538B\u7F29</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">zip</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token keyword">return</span> data<span class="token punctuation">;</span>
  <span class="token comment">// \u5224\u65AD\u6570\u636E\u662F\u5426\u9700\u8981\u8F6C\u4E3AJSON</span>
  <span class="token keyword">const</span> dataJson <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">&#39;string&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">&#39;number&#39;</span> <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">:</span> data<span class="token punctuation">;</span>
  <span class="token comment">// \u4F7F\u7528Base64.encode\u5904\u7406\u5B57\u7B26\u7F16\u7801\uFF0C\u517C\u5BB9\u4E2D\u6587</span>
  <span class="token keyword">const</span> str <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>dataJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> binaryString <span class="token operator">=</span> pako<span class="token punctuation">.</span><span class="token function">gzip</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> arr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>binaryString<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    s <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Base64<span class="token punctuation">.</span><span class="token function">btoa</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u89E3\u538B\u4EE3\u7801\u793A\u4F8B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Base64 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;js-base64&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> pako <span class="token keyword">from</span> <span class="token string">&#39;pako&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// \u89E3\u538B</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">unzip</span><span class="token punctuation">(</span><span class="token parameter">b64Data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> strData <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">atob</span><span class="token punctuation">(</span>b64Data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> charData <span class="token operator">=</span> strData<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> binData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>charData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> pako<span class="token punctuation">.</span><span class="token function">ungzip</span><span class="token punctuation">(</span>binData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u2193\u5207\u7247\u5904\u7406\u6570\u636E\uFF0C\u9632\u6B62\u5185\u5B58\u6EA2\u51FA\u62A5\u9519\u2193</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> chunk <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> i<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length <span class="token operator">/</span> chunk<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    str <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i <span class="token operator">*</span> chunk<span class="token punctuation">,</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> chunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  str <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i <span class="token operator">*</span> chunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u2191\u5207\u7247\u5904\u7406\u6570\u636E\uFF0C\u9632\u6B62\u5185\u5B58\u6EA2\u51FA\u62A5\u9519\u2191</span>
  <span class="token keyword">const</span> unzipStr <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  <span class="token comment">// \u5BF9\u8C61\u6216\u6570\u7EC4\u8FDB\u884CJSON\u8F6C\u6362</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>unzipStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Unexpected token o in JSON at position 0</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u5982\u679C\u6CA1\u6709\u8F6C\u6362\u6210\u529F\uFF0C\u4EE3\u8868\u503C\u4E3A\u57FA\u672C\u6570\u636E\uFF0C\u76F4\u63A5\u8D4B\u503C</span>
      result <span class="token operator">=</span> unzipStr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u4F55\u65F6\u4E0A\u62A5\u5F55\u5C4F\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#\u4F55\u65F6\u4E0A\u62A5\u5F55\u5C4F\u6570\u636E" aria-hidden="true">#</a> \u4F55\u65F6\u4E0A\u62A5\u5F55\u5C4F\u6570\u636E</h3><p>\u4E00\u822C\u5173\u6CE8\u7684\u662F\uFF0C\u9875\u9762\u62A5\u9519\u7684\u65F6\u5019\u7528\u6237\u505A\u4E86\u54EA\u4E9B\u64CD\u4F5C\uFF0C\u6240\u4EE5\u76EE\u524D\u53EA\u628A\u62A5\u9519\u524D10s\u7684\u5F55\u5C4F\u4E0A\u62A5\u5230\u670D\u52A1\u7AEF</p><p>\u5982\u4F55\u53EA\u4E0A\u62A5\u62A5\u9519\u65F6\u7684\u5F55\u5C4F\u4FE1\u606F\u5462 \uFF1F</p><p>1\uFF09window\u4E0A\u8BBE\u7F6E hasError\u3001recordScreenId \u53D8\u91CF\uFF0ChasError\u7528\u6765\u5224\u65AD\u67D0\u6BB5\u65F6\u95F4\u4EE3\u7801\u662F\u5426\u62A5\u9519\uFF1BrecordScreenId \u7528\u6765\u8BB0\u5F55\u6B64\u6B21\u5F55\u5C4F\u7684id</p><p>2\uFF09\u5F53\u9875\u9762\u53D1\u51FA\u62A5\u9519\u9700\u8981\u4E0A\u62A5\u65F6\uFF0C\u5224\u65AD\u662F\u5426\u5F00\u542F\u4E86\u5F55\u5C4F\uFF0C\u5982\u679C\u5F00\u542F\u4E86\uFF0C\u5C06 hasError \u8BBE\u4E3A true\uFF0C\u540C\u65F6\u5C06 window \u4E0A\u7684 recordScreenId\uFF0C\u5B58\u50A8\u5230\u6B64\u6B21\u4E0A\u62A5\u4FE1\u606F\u7684 data \u4E2D</p><p>3\uFF09rrweb \u8BBE\u7F6E10s\u91CD\u65B0\u5236\u4F5C\u5FEB\u7167\u7684\u9891\u7387\uFF0C\u6BCF\u6B21\u91CD\u7F6E\u5F55\u5C4F\u65F6\uFF0C\u5224\u65AD hasError \u662F\u5426\u4E3A true\uFF08\u5373\u8FD9\u6BB5\u65F6\u95F4\u5185\u662F\u5426\u53D1\u751F\u62A5\u9519\uFF09\uFF0C\u6709\u7684\u8BDD\u5C06\u8FD9\u6B21\u7684\u5F55\u5C4F\u4FE1\u606F\u4E0A\u62A5\uFF0C\u5E76\u91CD\u7F6E\u5F55\u5C4F\u4FE1\u606F\u548C recordScreenId\uFF0C\u4F5C\u4E3A\u4E0B\u6B21\u5F55\u5C4F\u4F7F\u7528</p><p>4\uFF09\u540E\u53F0\u62A5\u9519\u5217\u8868\uFF0C\u4ECE\u672C\u6B21\u62A5\u9519\u62A5\u7684data\u4E2D\u53D6\u51FA recordScreenId \u6765\u64AD\u653E\u5F55\u5C4F</p><p>\u5F55\u5C4F\u7684\u4EE3\u7801\u793A\u4F8B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">handleScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5B58\u50A8\u5F55\u5C4F\u4FE1\u606F</span>
  <span class="token keyword">let</span> events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> isCheckout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isCheckout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6B64\u6BB5\u65F6\u95F4\u5185\u53D1\u751F\u9519\u8BEF\uFF0C\u4E0A\u62A5\u5F55\u5C4F\u4FE1\u606F</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_support<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> recordScreenId <span class="token operator">=</span> _support<span class="token punctuation">.</span>recordScreenId<span class="token punctuation">;</span>
          <span class="token comment">// \u91CD\u7F6ErecordScreenId\uFF0C\u4F5C\u4E3A\u4E0B\u6B21\u4F7F\u7528</span>
          _support<span class="token punctuation">.</span>recordScreenId <span class="token operator">=</span> <span class="token function">generateUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          transportData<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">EVENTTYPES</span><span class="token punctuation">.</span><span class="token constant">RECORDSCREEN</span><span class="token punctuation">,</span>
            recordScreenId<span class="token punctuation">,</span>
            <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token constant">STATUS_CODE</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">,</span>
            <span class="token literal-property property">events</span><span class="token operator">:</span> <span class="token function">zip</span><span class="token punctuation">(</span>events<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          _support<span class="token punctuation">.</span>hasError <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// \u4E0D\u4E0A\u62A5\uFF0C\u6E05\u7A7A\u5F55\u5C4F</span>
          events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          _support<span class="token punctuation">.</span>recordScreenId <span class="token operator">=</span> <span class="token function">generateUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      events<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">recordCanvas</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// \u9ED8\u8BA4\u6BCF10s\u91CD\u65B0\u5236\u4F5C\u5FEB\u7167</span>
    <span class="token literal-property property">checkoutEveryNms</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token operator">*</span> options<span class="token punctuation">.</span>recordScreentime
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u652F\u6301-canvas-\u5F55\u5C4F" tabindex="-1"><a class="header-anchor" href="#\u652F\u6301-canvas-\u5F55\u5C4F" aria-hidden="true">#</a> \u652F\u6301 canvas \u5F55\u5C4F</h3><p>\u5F55\u5C4F\u4E2D\u53EF\u4EE5\u663E\u793A\u9875\u9762\u4E2D\u7684 canvas \u56FE\u5F62\uFF0C\u4EE5\u53CA\u9F20\u6807\u60AC\u6D6E\u65F6\u7684\u56FE\u5F62\u63D0\u793A\u4FE1\u606F</p><p>rrweb\u914D\u7F6E\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">rrwebPlayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">target</span><span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">events</span><span class="token operator">:</span> result<span class="token punctuation">,</span>
      <span class="token comment">// \u56DE\u653E\u65F6\u5F00\u542F\u56DE\u653E canvas \u5185\u5BB9</span>
      <span class="token literal-property property">UNSAFE_replayCanvas</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,17),A={href:"https://github.com/rrweb-io/rrweb/blob/master/docs/recipes/canvas.zh_CN.md",target:"_blank",rel:"noopener noreferrer"},N={href:"https://github.com/xy-sea/blog/tree/dev/rrweb",target:"_blank",rel:"noopener noreferrer"};function E(M,D){const a=o("ExternalLinkIcon");return c(),l("div",null,[r,u,s("p",null,[s("a",k,[n("web-see"),p(a)]),n(" \u524D\u7AEF\u76D1\u63A7\u65B9\u6848\uFF0C\u63D0\u4F9B\u4E86 \u524D\u7AEF\u5F55\u5C4F+\u5B9A\u4F4D\u6E90\u7801 \u65B9\u5F0F\uFF0C\u8BA9bug\u65E0\u5904\u85CF\u8EAB\u3002")]),d,s("p",null,[n("\u4EE3\u7801\u8FD8\u539F\uFF0C\u8FD9\u91CC\u4E3B\u8981\u4F7F\u7528 "),s("a",v,[n("source-map-js"),p(a)]),n(" \u5E93\uFF0C\u4E0B\u9762\u4ECB\u7ECD\u4E0B\u5982\u4F55\u4F7F\u7528")]),m,s("p",null,[n("\u4E3A\u4E86\u6D88\u9664\u5404\u6D4F\u89C8\u5668\u7684\u5DEE\u5F02\uFF0C\u4F7F\u7528 "),s("a",b,[n("error-stack-parser"),p(a)]),n(" \u5E93\u6765\u63D0\u53D6\u7ED9\u5B9A\u9519\u8BEF\u7684\u539F\u59CB\u6587\u4EF6\u540D\u3001\u884C\u548C\u5217\u4FE1\u606F")]),y,s("p",null,[n("\u4E0B\u8F7D "),s("a",w,[n("web-see-demo"),p(a)]),n(" \u5B89\u88C5\u5E76\u8FD0\u884C")]),g,s("p",null,[n("web-see \u76D1\u63A7\u901A\u8FC7 "),s("a",f,[n("rrweb"),p(a)]),n(" \u63D0\u4F9B\u4E86\u524D\u7AEF\u5F55\u5C4F\u7684\u529F\u80FD")]),h,s("p",null,[n("\u6570\u636E\u5982\u679C\u4E0D\u7ECF\u8FC7\u538B\u7F29\uFF0C\u76F4\u63A5\u4F20\u7ED9\u540E\u7AEF\uFF0C\u9762\u5BF9\u5927\u91CF\u7684\u7528\u6237\uFF0C\u9700\u8981\u975E\u5E38\u9AD8\u7684\u5E26\u5BBD\u505A\u652F\u6301\u3002\u8FD8\u597D\uFF0Crrweb\u5B98\u65B9\u63D0\u4F9B\u4E86"),s("a",_,[n("\u6570\u636E\u538B\u7F29\u51FD\u6570"),p(a)])]),j,s("p",null,[n("web-see \u5185\u90E8\u4F7F\u7528 "),s("a",S,[n("pako.js"),p(a)]),n("\u3001"),s("a",C,[n("js-base64"),p(a)]),n(" \u76F8\u7ED3\u5408\u7684\u538B\u7F29\u65B9\u5F0F\uFF0C\u5B9E\u6D4B\u4E0B\u6765\uFF0C\u538B\u7F29\u6BD4\u4E3A 85% \u4EE5\u4E0A\uFF0C\u539F\u6765 8M \u7684\u6570\u636E\uFF0C\u538B\u7F29\u540E\u4E3A 1.2M \u5DE6\u53F3")]),x,s("p",null,[s("a",A,[n("rrweb \u5B98\u65B9\u914D\u7F6E"),p(a)])]),s("p",null,[s("a",N,[n("\u6D4B\u8BD5demo"),p(a)])])])}const I=e(i,[["render",E],["__file","35.html.vue"]]);export{I as default};
