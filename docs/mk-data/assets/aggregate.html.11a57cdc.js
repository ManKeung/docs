import{_ as n,o as s,c as a,a as t}from"./app.296c1869.js";const p={},e=t(`<h1 id="mongodb\u7684\u9AD8\u7EA7\u67E5\u8BE2aggregate" tabindex="-1"><a class="header-anchor" href="#mongodb\u7684\u9AD8\u7EA7\u67E5\u8BE2aggregate" aria-hidden="true">#</a> MongoDB\u7684\u9AD8\u7EA7\u67E5\u8BE2aggregate</h1><h2 id="mongodb-aggregation-\u7BA1\u9053\u64CD\u4F5C\u7B26\u4E0E\u8868\u8FBE\u5F0F" tabindex="-1"><a class="header-anchor" href="#mongodb-aggregation-\u7BA1\u9053\u64CD\u4F5C\u7B26\u4E0E\u8868\u8FBE\u5F0F" aria-hidden="true">#</a> MongoDB Aggregation \u7BA1\u9053\u64CD\u4F5C\u7B26\u4E0E\u8868\u8FBE\u5F0F</h2><table><thead><tr><th>\u7BA1\u9053\u64CD\u4F5C\u7B26</th><th>Description</th></tr></thead><tbody><tr><td>$project</td><td>\u589E\u52A0\u3001\u5220\u9664\u3001\u91CD\u547D\u540D\u5B57\u6BB5</td></tr><tr><td>$match</td><td>\u6761\u4EF6\u5339\u914D\u3002\u53EA\u6EE1\u8DB3\u6761\u4EF6\u7684\u6587\u6863\u624D\u80FD\u8FDB\u5165\u4E0B\u4E00\u9636\u6BB5</td></tr><tr><td>$limit</td><td>\u9650\u5236\u7ED3\u679C\u7684\u6570\u91CF</td></tr><tr><td>$skip</td><td>\u8DF3\u8FC7\u6587\u6863\u7684\u6570\u91CF</td></tr><tr><td>$sort</td><td>\u6761\u4EF6\u6392\u5E8F\u3002</td></tr><tr><td>$group</td><td>\u6761\u4EF6\u7EC4\u5408\u7ED3\u679C \u7EDF\u8BA1</td></tr><tr><td>$lookup</td><td>$lookup \u64CD\u4F5C\u7B26 \u7528\u4EE5\u5F15\u5165\u5176\u5B83\u96C6\u5408\u7684\u6570\u636E \uFF08\u8868\u5173\u8054\u67E5\u8BE2\uFF09</td></tr></tbody></table><p>SQL\u548CNOSQL\u5BF9\u6BD4</p><table><thead><tr><th>SQL</th><th>NOSQL</th></tr></thead><tbody><tr><td>WHERE</td><td>$match</td></tr><tr><td>GROUP BY</td><td>$group</td></tr><tr><td>HAVING</td><td>$match</td></tr><tr><td>SELECT</td><td>$project</td></tr><tr><td>ORDER BY</td><td>$sort</td></tr><tr><td>LIMIT</td><td>$limit</td></tr><tr><td>SUM()</td><td>$sum</td></tr><tr><td>COUNT()</td><td>$sum</td></tr><tr><td>join</td><td>$lookup</td></tr></tbody></table><h2 id="mongodb-aggregation-\u7BA1\u9053\u64CD\u4F5C\u7B26\u4E0E\u8868\u8FBE\u5F0F-1" tabindex="-1"><a class="header-anchor" href="#mongodb-aggregation-\u7BA1\u9053\u64CD\u4F5C\u7B26\u4E0E\u8868\u8FBE\u5F0F-1" aria-hidden="true">#</a> MongoDB Aggregation \u7BA1\u9053\u64CD\u4F5C\u7B26\u4E0E\u8868\u8FBE\u5F0F</h2><table><thead><tr><th>\u7BA1\u9053\u64CD\u4F5C\u7B26</th><th>Description</th></tr></thead><tbody><tr><td>$project</td><td>\u589E\u52A0\u3001\u5220\u9664\u3001\u91CD\u547D\u540D\u5B57\u6BB5</td></tr><tr><td>$match</td><td>\u6761\u4EF6\u5339\u914D\u3002\u53EA\u6EE1\u8DB3\u6761\u4EF6\u7684\u6587\u6863\u624D\u80FD\u8FDB\u5165\u4E0B\u4E00\u9636\u6BB5</td></tr><tr><td>$limit</td><td>\u9650\u5236\u7ED3\u679C\u7684\u6570\u91CF</td></tr><tr><td>$skip</td><td>\u8DF3\u8FC7\u6587\u6863\u7684\u6570\u91CF</td></tr><tr><td>$sort</td><td>\u6761\u4EF6\u6392\u5E8F\u3002</td></tr><tr><td>$group</td><td>\u6761\u4EF6\u7EC4\u5408\u7ED3\u679C \u7EDF\u8BA1</td></tr><tr><td>$lookup</td><td>$lookup \u64CD\u4F5C\u7B26 \u7528\u4EE5\u5F15\u5165\u5176\u5B83\u96C6\u5408\u7684\u6570\u636E \uFF08\u8868\u5173\u8054\u67E5\u8BE2\uFF09</td></tr></tbody></table><p>SQL\u548CNOSQL\u5BF9\u6BD4</p><table><thead><tr><th>SQL</th><th>NOSQL</th></tr></thead><tbody><tr><td>WHERE</td><td>$match</td></tr><tr><td>GROUP BY</td><td>$group</td></tr><tr><td>HAVING</td><td>$match</td></tr><tr><td>SELECT</td><td>$project</td></tr><tr><td>ORDER BY</td><td>$sort</td></tr><tr><td>LIMIT</td><td>$limit</td></tr><tr><td>SUM()</td><td>$sum</td></tr><tr><td>COUNT()</td><td>$sum</td></tr><tr><td>join</td><td>$lookup</td></tr></tbody></table><h2 id="\u6570\u636E\u6A21\u62DF" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u6A21\u62DF" aria-hidden="true">#</a> \u6570\u636E\u6A21\u62DF</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>db.order.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;order_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;1&quot;</span>,<span class="token string">&quot;uid&quot;</span>:10,<span class="token string">&quot;trade_no&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;111&quot;</span>,<span class="token string">&quot;all_price&quot;</span>:100,<span class="token string">&quot;all_num&quot;</span>:2<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.order.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;order_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2&quot;</span>,<span class="token string">&quot;uid&quot;</span>:7,<span class="token string">&quot;trade_no&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;222&quot;</span>,<span class="token string">&quot;all_price&quot;</span>:90,<span class="token string">&quot;all_num&quot;</span>:2<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.order.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;order_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;3&quot;</span>,<span class="token string">&quot;uid&quot;</span>:9,<span class="token string">&quot;trade_no&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;333&quot;</span>,<span class="token string">&quot;all_price&quot;</span>:20,<span class="token string">&quot;all_num&quot;</span>:6<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.order_item.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;order_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;1&quot;</span>,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;\u5546\u54C1\u9F20\u6807 1&quot;</span>,<span class="token string">&quot;price&quot;</span>:50,num:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.order_item.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;order_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;1&quot;</span>,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;\u5546\u54C1\u952E\u76D8 2&quot;</span>,<span class="token string">&quot;price&quot;</span>:50,num:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.order_item.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;order_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;1&quot;</span>,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;\u5546\u54C1\u952E\u76D8 3&quot;</span>,<span class="token string">&quot;price&quot;</span>:0,num:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.order_item.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;order_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2&quot;</span>,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;\u725B\u5976&quot;</span>,<span class="token string">&quot;price&quot;</span>:50,num:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.order_item.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;order_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2&quot;</span>,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;\u9178\u5976&quot;</span>,<span class="token string">&quot;price&quot;</span>:40,num:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.order_item.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;order_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;3&quot;</span>,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;\u77FF\u6CC9\u6C34&quot;</span>,<span class="token string">&quot;price&quot;</span>:2,num:5<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.order_item.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;order_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;3&quot;</span>,<span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;\u6BDB\u5DFE&quot;</span>,<span class="token string">&quot;price&quot;</span>:10,num:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="project" tabindex="-1"><a class="header-anchor" href="#project" aria-hidden="true">#</a> $project</h2><p>\u4FEE\u6539\u6587\u6863\u7684\u7ED3\u6784\uFF0C\u53EF\u4EE5\u7528\u6765\u91CD\u547D\u540D\u3001\u589E\u52A0\u6216\u5220\u9664\u6587\u6863\u4E2D\u7684\u5B57\u6BB5\u3002</p><ul><li>\u8981\u6C42\u67E5\u627E order \u53EA\u8FD4\u56DE\u6587\u6863\u4E2D trade_no \u548C all_price \u5B57\u6BB5</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>db.order.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token variable">$project</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>trade_no: <span class="token number">1</span>, all_price: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="match" tabindex="-1"><a class="header-anchor" href="#match" aria-hidden="true">#</a> $match</h2><p>\u7528\u4E8E\u8FC7\u6EE4\u6587\u6863\u3002\u7528\u6CD5\u7C7B\u4F3C\u4E8E find() \u65B9\u6CD5\u4E2D\u7684\u53C2\u6570\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>db.order.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token variable">$project</span>:<span class="token punctuation">{</span> trade_no: <span class="token number">1</span>, all_price: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$match</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>all_price: <span class="token punctuation">{</span><span class="token variable">$gte</span><span class="token builtin class-name">:</span> <span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="group" tabindex="-1"><a class="header-anchor" href="#group" aria-hidden="true">#</a> ## $group</h1><p>\u5C06\u96C6\u5408\u4E2D\u7684\u6587\u6863\u8FDB\u884C\u5206\u7EC4\uFF0C\u53EF\u7528\u4E8E\u7EDF\u8BA1\u7ED3\u679C\u3002 \u7EDF\u8BA1\u6BCF\u4E2A\u8BA2\u5355\u7684\u8BA2\u5355\u6570\u91CF\uFF0C\u6309\u7167\u8BA2\u5355\u53F7\u5206\u7EC4</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>db.order_item.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token variable">$group</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>_id: <span class="token string">&#39;$order_id&#39;</span>, toal: <span class="token punctuation">{</span><span class="token variable">$sum</span><span class="token builtin class-name">:</span> <span class="token string">&#39;$num&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="sort" tabindex="-1"><a class="header-anchor" href="#sort" aria-hidden="true">#</a> $sort</h2><p>\u5C06\u96C6\u5408\u4E2D\u7684\u6587\u6863\u8FDB\u884C\u6392\u5E8F\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>db.order.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token variable">$project</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>trade_no: <span class="token number">1</span>, all_price: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$match</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>all_price: <span class="token punctuation">{</span><span class="token variable">$gte</span>:90<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$sort</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>all_price: -1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="limit" tabindex="-1"><a class="header-anchor" href="#limit" aria-hidden="true">#</a> $limit</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>db.order.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token variable">$project</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>trade_no: <span class="token number">1</span>, all_price: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$match</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>all_price: <span class="token punctuation">{</span><span class="token variable">$gte</span>:90<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$sort</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>all_price: -1<span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$limit</span><span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="skip" tabindex="-1"><a class="header-anchor" href="#skip" aria-hidden="true">#</a> $skip</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>db.order.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token variable">$project</span>:<span class="token punctuation">{</span> trade_no: <span class="token number">1</span>, all_price: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$match</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>all_price: <span class="token punctuation">{</span><span class="token variable">$gte</span><span class="token builtin class-name">:</span> <span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$sort</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>all_price: -1<span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$skip</span><span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="lookup-\u8868\u5173\u8054" tabindex="-1"><a class="header-anchor" href="#lookup-\u8868\u5173\u8054" aria-hidden="true">#</a> $lookup \u8868\u5173\u8054</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>db.order.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token variable">$lookup</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>from: <span class="token string">&#39;order_item&#39;</span>, localField: <span class="token string">&#39;order_id&#39;</span>, foreignField: <span class="token string">&#39;order_id&#39;</span>, as: <span class="token string">&#39;items&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>db.order.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token variable">$lookup</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>from: <span class="token string">&#39;order_item&#39;</span>, localField: <span class="token string">&#39;order_id&#39;</span>, foreignField: <span class="token string">&#39;order_id&#39;</span>, as: <span class="token string">&#39;items&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$match</span>:<span class="token punctuation">{</span><span class="token string">&quot;all_price&quot;</span>:<span class="token punctuation">{</span><span class="token variable">$gte</span>:90<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,31),o=[e];function c(i,l){return s(),a("div",null,o)}const r=n(p,[["render",c],["__file","aggregate.html.vue"]]);export{r as default};
